<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CacheStorage å•ç‹¬ä½¿ç”¨ Demo</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin-right: 10px; cursor: pointer; }
        #status { margin-top: 10px; color: #666; }
        #result-area { margin-top: 20px; border: 1px dashed #ccc; padding: 10px; min-height: 100px; }
        img { max-width: 300px; display: block; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>CacheStorage ç‹¬ç«‹ä½¿ç”¨ç¤ºä¾‹</h1>
    <p>æ‰“å¼€æ§åˆ¶å°(F12) -> Application -> Cache Storage å¯ä»¥æŸ¥çœ‹å­˜å‚¨æƒ…å†µ</p>
    
    <div>
        <button id="btn-save">1. ä¸‹è½½å¹¶ç¼“å­˜å›¾ç‰‡</button>
        <button id="btn-load">2. ä»ç¼“å­˜è¯»å–å›¾ç‰‡</button>
        <button id="btn-delete">3. æ¸…é™¤ç¼“å­˜</button>
    </div>

    <div id="status"></div>
    <div id="result-area">å›¾ç‰‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>

    <script>
        // å®šä¹‰ç¼“å­˜åº“çš„åå­—
        const CACHE_NAME = 'my-image-cache-v1';
        // æˆ‘ä»¬è¦ç¼“å­˜çš„èµ„æº URL (è¿™é‡Œç”¨ä¸€å¼ éšæœºå›¾ç‰‡)
        const IMG_URL = 'https://picsum.photos/300/200';

        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result-area');

        function log(msg) {
            statusDiv.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
        }

        // 1. å­˜ï¼šä¸‹è½½å¹¶å†™å…¥ CacheStorage
        document.getElementById('btn-save').onclick = async () => {
            try {
                // æ‰“å¼€ç¼“å­˜åº“ï¼ˆå¦‚æœæ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰
                const cache = await caches.open(CACHE_NAME);
                
                log('æ­£åœ¨è¯·æ±‚å›¾ç‰‡...');
                // cache.add() ä¼šè‡ªåŠ¨å‘èµ· fetch è¯·æ±‚ï¼Œå¹¶æŠŠ response å­˜è¿›å»
                // æ³¨æ„ï¼šå¦‚æœè·¨åŸŸå›¾ç‰‡æ²¡æœ‰ CORS å¤´ï¼Œadd() å¯èƒ½ä¼šå¤±è´¥ã€‚
                // è¿™é‡Œçš„ picsum.photos é€šå¸¸æ”¯æŒ CORSã€‚
                await cache.add(IMG_URL);
                
                log('âœ… å›¾ç‰‡å·²æˆåŠŸå­˜å…¥ CacheStorageï¼');
            } catch (err) {
                console.error(err);
                log('âŒ ç¼“å­˜å¤±è´¥: ' + err.message);
            }
        };

        // 2. å–ï¼šä» CacheStorage è¯»å–
        document.getElementById('btn-load').onclick = async () => {
            try {
                // æ‰“å¼€ç¼“å­˜åº“
                const cache = await caches.open(CACHE_NAME);
                
                // æŸ¥æ‰¾åŒ¹é…çš„è¯·æ±‚
                const response = await cache.match(IMG_URL);

                if (response) {
                    log('âœ… å‘½ä¸­ç¼“å­˜ï¼æ­£åœ¨è¯»å– Blob...');
                    // æŠŠå“åº”æµè½¬æˆ Blob å›¾ç‰‡
                    const blob = await response.blob();
                    const imgUrl = URL.createObjectURL(blob);
                    
                    // æ˜¾ç¤ºå›¾ç‰‡
                    resultDiv.innerHTML = `<img src="${imgUrl}" alt="Cached Image">`;
                    resultDiv.innerHTML += `<p>æ¥æº: CacheStorage (éç½‘ç»œè¯·æ±‚)</p>`;
                } else {
                    log('âš ï¸ æœªæ‰¾åˆ°ç¼“å­˜ï¼Œè¯·å…ˆç‚¹å‡»â€œä¿å­˜â€æŒ‰é’®ã€‚');
                    resultDiv.innerText = 'æœªæ‰¾åˆ°ç¼“å­˜å›¾ç‰‡';
                }
            } catch (err) {
                log('âŒ è¯»å–å¤±è´¥: ' + err.message);
            }
        };

        // 3. åˆ ï¼šåˆ é™¤æ•´ä¸ªç¼“å­˜åº“
        document.getElementById('btn-delete').onclick = async () => {
            const success = await caches.delete(CACHE_NAME);
            if (success) {
                log('ğŸ—‘ï¸ ç¼“å­˜åº“å·²åˆ é™¤');
                resultDiv.innerHTML = '';
            } else {
                log('âš ï¸ åˆ é™¤å¤±è´¥æˆ–ç¼“å­˜ä¸å­˜åœ¨');
            }
        };
    </script>   
</body>
</html>